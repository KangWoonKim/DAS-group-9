---
title: "Obesity in Scotland in relation to factors included in the Scottish Health Surveys of 2008 and 2012"
author: "Group 9 (2718740K Kyle Kim)"
number-sections: true 
format: 
  html:
    embed-resources: true
    code-tools: true
  pdf: default
editor_options: 
  chunk_output_type: console
---

# Introduction {#sec-intro}

Obesity represents a significant public health issue globally, linked to numerous chronic diseases and a major cause of premature morbidity and mortality. Scotland has the highest obesity rate in the UK in addition to having one of the highest in the developed world which clearly emphasises the significance of the problem. The Scottish health surveys from 2008 and 2012 collected data from individuals regarding their Age, Sex, Education, Body Mass Index (BMI) and whether they consumed the recommended daily fruit and vegetable intake in order to examine the prevalence and determinants of obesity in Scotland. It aims to identify trends in obesity rates over the years and explore how demographic factors, socio-economic status, and lifestyle choices such as diet impact obesity levels. Through descriptive statistics and logistic regression analysis we will be investigating whether the prevalence of obesity in Scotland changed over the given years (2008 to 2012). Additionally, whether the obesity status of individuals is effected differently in relation to their age, gender, socio-economic status or lifestyle factors. From this, we can offer evidence-based recommendations for public health strategies to mitigate this growing health concern.

In @sec-eda, we will go through an exploratory analysis of obesity trend over 2008 to 2012 and relationship between obesity and various influencing factors, including age, gender, education level, and daily consumption of vegetables and fruits in order to uncover preliminary insights and trends. This is done using a variety of plots and tables that emphasise the relationship between the prevalence of obesity in Scotland and the various influencing factors.

Moreover, @sec-fda consists of the results from fitting the regression model to the data and evaluating the assumptions of the model. This segment will delve into logistic regression analyses to quantify the impact of different predictors on obesity, providing a more nuanced understanding of its determinants and giving us an idea of which of the stated influencing factors are significant and the way in which they impact the increase in the prevalence of Obesity in Scotland.

The conclusion will be given in @sec-ccls, where we gather our findings, discuss the implications for public health policy and practice, and suggest directions for future research. This final section aims to encapsulate the key insights derived from the analysis and underscore their relevance to tackling the problem of obesity in Scotland.

```{r}
#| warning: false
#| message: false 
#| echo: false 
library(ggplot2)
library(dplyr)
library(moderndive)
library(skimr)
library(kableExtra)
library(gridExtra)
library(gapminder)
library(MASS)
library(knitr)
library(datasets)
library(broom)
library(infer)
library(janitor)
library(tidyr)
library(ISLR)
library(readr)
library(stats)
library(sjPlot)
library(patchwork)
library(tidymodels)
```

# Exploratory data analysis {#sec-eda}

```{r}
#| warning: false
#| message: false 
#| echo: false 

data <- read_csv("DAProject1.csv")
data <- na.omit(data)

data$Obese <- as.factor(data$Obese)
data$Sex <- as.factor(data$Sex)
data$Education <- as.factor(data$Education)
data$Veg <- as.factor(data$Veg)
data$Fruit <- as.factor(data$Fruit)


```

```{r}
#| warning: false
#| message: false 
#| echo: false 
obesity_prevalence <- data %>%
  group_by(Year) %>%
  summarise(Obese_Yes = sum(Obese == "Yes") / n() * 100,
            Obese_No = sum(Obese == "No") / n() * 100)
obesity_prevalence_long <- pivot_longer(obesity_prevalence, c("Obese_Yes", "Obese_No"), names_to = "Obesity", values_to = "Percentage")

obesity_Age <- data %>%
  group_by(Age) %>%
  summarise(Obese_Yes = sum(Obese == "Yes") / n() * 100,
            Obese_No = sum(Obese == "No") / n() * 100)
obesity_age_long <- pivot_longer(obesity_Age, c("Obese_Yes", "Obese_No"), names_to = "Obesity", values_to = "Percentage")


obesity_Sex <- data %>%
  group_by(Sex) %>%
  summarise(Obese_Yes = sum(Obese == "Yes") / n() * 100,
            Obese_No = sum(Obese == "No") / n() * 100)
obesity_Sex_long <- pivot_longer(obesity_Sex, c("Obese_Yes", "Obese_No"), names_to = "Obesity", values_to = "Percentage")


obesity_Edu <- data %>%
  group_by(Education) %>%
  summarise(Obese_Yes = sum(Obese == "Yes") / n() * 100,
            Obese_No = sum(Obese == "No") / n() * 100)
obesity_Edu_long <- pivot_longer(obesity_Edu, c("Obese_Yes", "Obese_No"), names_to = "Obesity", values_to = "Percentage")


obesity_Veg <- data %>%
  group_by(Veg) %>%
  summarise(Obese_Yes = sum(Obese == "Yes") / n() * 100,
            Obese_No = sum(Obese == "No") / n() * 100)
obesity_Veg_long <- pivot_longer(obesity_Veg, c("Obese_Yes", "Obese_No"), names_to = "Obesity", values_to = "Percentage")

obesity_Fruit <- data %>%
  group_by(Fruit) %>%
  summarise(Obese_Yes = sum(Obese == "Yes") / n() * 100,
            Obese_No = sum(Obese == "No") / n() * 100)
obesity_Fruit_long <- pivot_longer(obesity_Fruit, c("Obese_Yes", "Obese_No"), names_to = "Obesity", values_to = "Percentage")
```

```{r}
#| echo: false
#| fig-cap: Scotland's Obesity prevalence over the factors
#| label: fig-bar
#| fig-align: center
#| message: false
#| warning: false

# Plot 


# Plot
p1<-ggplot(obesity_age_long, aes(x = Age, y = Percentage, fill = Obesity)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Obesity prevalence in Scotland by Age",
       x = "Age",
       y = "Percentage (%)",
       fill = "Obesity Status")

# Plot 
p2<-ggplot(obesity_Sex_long, aes(x = Sex, y = Percentage, fill = Obesity)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Obesity prevalence in Scotland by Sex",
       x = "Sex",
       y = "Percentage (%)",
       fill = "Obesity Status")

# Plot 
p3<- ggplot(obesity_Edu_long, aes(x = Education, y = Percentage, fill = Obesity)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Obesity prevalence in Scotland by Education",
       x = "Education",
       y = "Percentage (%)",
       fill = "Obesity Status")+
  theme(axis.text.x = element_text(size = 2))

# Plot 
p4<-ggplot(obesity_Veg_long, aes(x = Veg, y = Percentage, fill = Obesity)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Obesity prevalence in Scotland by Veg",
       x = "Veg",
       y = "Percentage (%)",
       fill = "Obesity Status")

# Plot 
p5<-ggplot(obesity_Fruit_long, aes(x = Fruit, y = Percentage, fill = Obesity)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Obesity prevalence in Scotland by Fruit",
       x = "Fruit",
       y = "Percentage (%)",
       fill = "Obesity Status")


```

@tbl-obe_year presents the obesity percentage in Scotland from 2008 to 2012, indicating a slight fluctuation over the years with a notable peak in 2010 at 30.47%. The corresponding @fig-line_year illustrates these changes with a line graph that sharply rises in 2010 and then declines, making it visually apparent that while there is an overall stability in obesity rates, there was a significant but brief increase in 2010.

```{r}
#| echo: false
#| label: tbl-obe_year
#| tbl-cap: prevalence of obesity over the year 2008 - 2012
obesity_by_year <- data %>%
  group_by(Year) %>%
  summarise(Obesity_Percentage = mean(Obese == "Yes") * 100)
kable(obesity_by_year)
```

```{r}
#| warning: false
#| message: false 
#| echo: false 
#| fig-cap: Percentage of obese people in Scotland by year
#| label: fig-line_year
ggplot(data=obesity_prevalence, mapping=aes(x=Year, y=Obese_Yes))+
 geom_line()+
     labs(title = "Obesity prevalence in Scotland by Year",
          x = "Year",
          y = "Percentage of Obesity (%)",
          )
```

@tbl-obe_Age and @fig-bar_age suggest a pattern in the prevalence of obesity among different age groups in Scotland. The percentage of obesity appears to rise with increasing age, peaking in the age group of 60-70 years, where it reaches 35.9%. This suggests that individuals in this age range have the highest proportion of obesity compared to other age groups. Following this peak, there is a noticeable decline in the percentage of obesity as age continues to increase, with the group aged 90 and above having the lowest obesity percentage at 9.52%.

```{r}
#| echo: false
#| label: tbl-obe_Age
#| tbl-cap: Obesity percentage table by age group
data$Age_Group <- cut(data$Age, breaks=c(0, 18, 30, 40, 50, 60, 70,80,90,Inf), labels=c("0-18", "19-30", "31-40", "41-50", "51-60", "60-70","70-80","80-90","90+"))
obesity_by_age_group <- data %>%
  group_by(Age_Group) %>%
  summarise(Obesity_Percentage = mean(Obese == "Yes") * 100)
kable(obesity_by_age_group)
```

```{r}
#| echo: false
#| fig-cap: Percentage of obese people in Scotland by age group
#| label: fig-bar_age
#| fig-align: center
#| fig-width: 4
#| fig-height: 3
#| message: false
#| warning: false

p1
```

@tbl-obe_sex presents a comparison of obesity prevalence between females and males in Scotland, revealing a marginal difference between the sexes. The obesity rate for females stands at 29.80659%, which is just 0.4% higher than the rate for males, which is 29.36790%. This is visually represented in @fig-bar_sex, where the bar corresponding to females is slightly taller than that for males, indicating this small but noticeable difference. The graph demonstrates that obesity is a significant health issue for both females and males in Scotland, with both experiencing high prevalence rates.

```{r}
#| echo: false
#| label: tbl-obe_sex
#| tbl-cap: Obesity percentage table by gender
obesity_by_sex <- data %>%
  group_by(Sex) %>%
  summarise(Obesity_Percentage = mean(Obese == "Yes") * 100)
kable(obesity_by_sex)
```

```{r}
#| echo: false
#| fig-cap: Percentage of obese people in Scotland by Gender
#| label: fig-bar_sex
#| fig-align: center
#| fig-width: 4
#| fig-height: 3
#| message: false
#| warning: false

p2
```

@tbl-obe_edu and @fig-bar_edu illustrate the relationship between educational attainment and obesity prevalence in Scotland. The data indicates a trend where obesity prevalence decreases with higher levels of education. Individuals with no qualifications have the highest obesity rate at 36.46659%, while those with a degree or higher have the lowest at 24.77144%. This pattern suggests that educational level may be inversely related to the likelihood of being obese.

```{r}
#| echo: false
#| label: tbl-obe_edu
#| tbl-cap:  Obesity percentage table by education
obesity_by_education <- data %>%
  group_by(Education) %>%
  summarise(Obesity_Percentage = mean(Obese == "Yes") * 100)
kable(obesity_by_education)
```

```{r}
#| echo: false
#| fig-cap: Percentage of obese people in Scotland by Education
#| label: fig-bar_edu
#| fig-align: center
#| fig-width: 4
#| fig-height: 3
#| message: false
#| warning: false

p3
```

@tbl-ob_veg and @fig-bar_Veg explore the obesity prevalence in Scotland with respect to vegetarianism. From the information provided, individuals who do not follow a vegetarian diet have a higher obesity percentage, recorded at 32.06191%. In contrast, those who identify as vegetarian have a lower obesity percentage, at 28.93873%. This is visually represented in @fig-bar_Veg, where the bar corresponding to non-vegetarians is notably higher than that for vegetarians.

```{r}
#| echo: false
#| label: tbl-ob_veg
#| tbl-cap:  Obesity percentage table by vegetarian
obesity_by_veg <- data %>%
  group_by(Veg) %>%
  summarise(Obesity_Percentage = mean(Obese == "Yes") * 100)
kable(obesity_by_veg)
```

```{r}
#| echo: false
#| fig-cap: Percentage of obese people in Scotland by Vegetarian
#| label: fig-bar_Veg
#| fig-align: center
#| fig-width: 4
#| fig-height: 3
#| message: false
#| warning: false


p4
```

@tbl-ob_fruit and @fig-bar_Fruit, which address fruit consumption, present a more nuanced picture. The obesity percentage for individuals who do not consume fruit is at 29.36099%, while the percentage for those who eat fruit is at 29.72168%. This difference is minor and, unlike the vegetarianism comparison, does not suggest a clear trend; the bars in the graph are almost equal in height. This lack of significant disparity could imply that fruit consumption, in isolation, does not have a strong correlation with obesity prevalence, or it could reflect that the amount and type of fruit consumed, as well as other dietary and lifestyle factors, play a role in the complex relationship with obesity.

```{r}
#| echo: false
#| label: tbl-ob_fruit
#| tbl-cap:  Obesity percentage table by fruit
obesity_by_fruit <- data %>%
  group_by(Fruit) %>%
  summarise(Obesity_Percentage = mean(Obese == "Yes") * 100)
kable(obesity_by_fruit)
```

```{r}
#| echo: false
#| fig-cap: Percentage of obese people in Scotland by Fruit
#| label: fig-bar_Fruit
#| fig-width: 4
#| fig-height: 3
#| fig-align: center
#| message: false
#| warning: false

p5
```

# Formal data analysis {#sec-fda}

## Prevalence of obesity from 2008 to 2012

Next, we formally analyse the data by considering each objectives in turn. Firstly, The logistic regression model for obesity prevalence from 2008 to 2012 which will be fitted is given below : 

$$
\ \log\left(\frac{p_i}{1-p_i}\right) = \beta_0 + \beta_1 Year(x) +  \epsilon, ~~\epsilon \sim N(0, \sigma^2)\\
i~=~1,\cdot\cdot\cdot~,25224
$$

where

-   $p$ denotes the probability of the outcome being obese (outcome 1)

-   $\beta_0$ denotes the intercept of the regression line for the baseline Year (2008)

-   $\beta_1$ denotes the coefficients for the specified Year

-   $\epsilon$ denotes random error component which are normally distributed with mean zero

-   $\sigma^2$ denotes variance

The analysis of the data presented in @tbl-regyear reveals that the coefficients β0 and β1 are -12.13 and 0.0056, respectively. Despite these values, the significance tests indicate that they are not statistically significant at the 5% level, with p-values of 0.5581 and 0.5865, respectively. This aligns with the preliminary observations discussed in @sec-eda, reinforcing the conclusion that the evidence is inadequate to suggest any significant variation in obesity prevalence in Scotland from 2008 to 2012. Thus, the initial hypothesis suggesting a change in obesity rates within the observed period is not supported by the empirical analysis.

```{r}
#| echo: false
#| label: tbl-regyear
#| tbl-cap: Estimates of the regression model coefficients (year).

obesity_Year <- data |>
  dplyr::select(Obese, Year)

model_year <- logistic_reg() |>
  set_engine("glm") |>
  fit(Obese ~ Year, data =obesity_Year) |>
  extract_fit_engine()

dataframe1 <- data.frame(
  Groups = c( "Intercept", "Year"),
  Estimates = summary(model_year)$coefficients[,1],
  pvalues = summary(model_year)$coefficients[,4]
)

kable(dataframe1, row.names = FALSE)
```

## Prevalence of Obesity on the explanatory variables Age, Sex, Education and dietary habits

The model was established by including an array of independent variables such as age, sex, various educational levels, and dietary habits encompassing vegetable and fruit intake. This logistic regression model was selected due to the binary nature of the dependent variable---obesity, categorized as 'obese_yes' or 'obese_no'. The model sought to express the log-odds of the probability of being obese as a linear combination of the predictors, as illustrated by the logistic function:


$$
\ \log\left(\frac{p_i}{1-p_i}\right) = \beta_0 + \beta_1 Age(x_1) + \beta_2 Sex(x_2) + \beta_3 Education(x_3)\\+\beta_4Veg(x_4) + \beta_5 Fruit(x_5) + \epsilon, ~~\epsilon \sim N(0, \sigma^2)\\ i~=~1,\cdot\cdot\cdot~,25224
$$

where

-   $p$ denotes the probability of the outcome being obese (outcome 1)

-   $\beta_0$ denotes the intercept

-   $\beta_1 , \cdot\cdot\cdot,\beta_5$ denotes the coefficients of the predictor variables

-   $\epsilon$ denotes random error component which are normally distributed with mean zero

-   $\sigma^2$ denotes variance

we can fit the logistic regression model as follows @tbl-regmodel1:


```{r}
#| echo: false
#| label: tbl-regmodel1
#| tbl-cap: Estimates of the regression model coefficients.

obesity_by_factors <- data |>
  dplyr::select(Obese, Age, Sex, Education, Veg, Fruit)

model_factors <- logistic_reg() |>
  set_engine("glm") |>
  fit(Obese ~ Age + Sex + Education + Veg + Fruit, data =obesity_by_factors) |>
  extract_fit_engine()

dataframeone <- data.frame(
  Groups = c( "Intercept", "Age","Sex (Male)","Education Higher","Education HNC/D", "Education no", "Education other", "Education Standard", "Vegetable intake", "Fruit intake"),
  Estimates = summary(model_factors)$coefficients[,1],
  pvalues = summary(model_factors)$coefficients[,4]
)

kable(dataframeone, row.names = FALSE)

```

Upon evaluation of the `model_factors`, `Sex (Male)` and `Fruit` consumption were found to have p-values exceeding the threshold of 0.05, indicating that they do not significantly contribute to the prediction of obesity. Consequently, these variables were removed to refine the model. The refined model coefficients were obtained and are presented in @tbl-regmodel2, which excludes the aforementioned insignificant factors.

```{r}
#| echo: false
#| output: false


AIC <- stepAIC(model_factors)
```

To evaluate the goodness of fit for the logistic regression model, the stepwise selection procedure known as stepAIC was employed. The application of stepAIC to the logistic regression model resulted in the exclusion of variables 'Sex' and 'Fruit' intake, as their presence did not contribute to a reduction in the AIC score, suggesting that their inclusion did not improve the model's predictive ability significantly. The final model, which excludes these variables, is considered to be more parsimonious and theoretically sound for predicting the probability of obesity in the studied population.

```{r}
#| echo: false
#| label: tbl-regmodel2
#| tbl-cap: Estimates of the regression model coefficients.
dataframe <- data.frame(
  Groups = c( "Intercept", "Age","Education Higher","Education HNC/D", "Education no", "Education other", "Education Standard", "Vegetable intake"),
  Estimates = summary(AIC)$coefficients[,1],
  pvalues = summary(AIC)$coefficients[,4]
)

kable(dataframe, row.names = FALSE)
```

The logistic regression equation derived from the model refinement using the stepAIC process, each independent variable's coefficient is integral to the calculation of the log-odds of the probability, p, of an individual being obese. The logistic function is represented as follows:: 

$$
\ \log\left(\frac{p}{1-p}\right) = -1.556 + 0.012 Age+ 0.148Education_{Higher}+0.240Education_{HNC/D}\\+0.386Education_{No}+0.219Education_{Other}+0.305Education_{Standard}-0.140Veg + \epsilon, ~~\epsilon \sim N(0, \sigma^2)
$$

where p is probability of being obese and 1-p is probability of being not obese. The model delineates that, there is a 1.2% escalation in the log-odds of obesity, affirming age as a significant factor, with other variables held constant.

Further analysis and interpretation of this model should take into account the log-odds 95% confidence intervals for these coefficients to assess the precision of the estimates. These intervals are essential for understanding the range within which the true value of the coefficients is likely to lie, with a 95% level of confidence. 

```{r}
#| echo: false

mod.factors.coef.logodds <- AIC |>
  summary()|>
  coef()

Age.logodds.lower <- (mod.factors.coef.logodds["Age", "Estimate"]- 1.96 * mod.factors.coef.logodds["Age", "Std. Error"])

Age.logodds.upper <- (mod.factors.coef.logodds["Age", "Estimate"] + 1.96 * mod.factors.coef.logodds["Age", "Std. Error"])


Edu.higher.logodds.lower <- (mod.factors.coef.logodds["EducationHigher grade or equiv", "Estimate"]- 1.96 * mod.factors.coef.logodds["EducationHigher grade or equiv", "Std. Error"])

Edu.higher.logodds.upper <- (mod.factors.coef.logodds["EducationHigher grade or equiv", "Estimate"] + 1.96 * mod.factors.coef.logodds["EducationHigher grade or equiv", "Std. Error"])


Edu.HNC.logodds.lower <- (mod.factors.coef.logodds["EducationHNC/D or equiv", "Estimate"]- 1.96 * mod.factors.coef.logodds["EducationHNC/D or equiv", "Std. Error"])

Edu.HNC.logodds.upper <- (mod.factors.coef.logodds["EducationHNC/D or equiv", "Estimate"] + 1.96 * mod.factors.coef.logodds["EducationHNC/D or equiv", "Std. Error"])


Edu.no.logodds.lower <- (mod.factors.coef.logodds["EducationNo qualifications", "Estimate"]- 1.96 * mod.factors.coef.logodds["EducationNo qualifications", "Std. Error"])

Edu.no.logodds.upper <- (mod.factors.coef.logodds["EducationNo qualifications", "Estimate"] + 1.96 * mod.factors.coef.logodds["EducationNo qualifications", "Std. Error"])

Edu.other.logodds.lower <- (mod.factors.coef.logodds["EducationOther school level", "Estimate"]- 1.96 * mod.factors.coef.logodds["EducationOther school level", "Std. Error"])

Edu.other.logodds.upper <- (mod.factors.coef.logodds["EducationOther school level", "Estimate"] + 1.96 * mod.factors.coef.logodds["EducationOther school level", "Std. Error"])


Edu.standard.logodds.lower <- (mod.factors.coef.logodds["EducationStandard grade or equiv", "Estimate"]- 1.96 * mod.factors.coef.logodds["EducationStandard grade or equiv", "Std. Error"])

Edu.standard.logodds.upper <- (mod.factors.coef.logodds["EducationStandard grade or equiv", "Estimate"] + 1.96 * mod.factors.coef.logodds["EducationStandard grade or equiv", "Std. Error"])


Veg.logodds.lower <- (mod.factors.coef.logodds["VegYes", "Estimate"]- 1.96 * mod.factors.coef.logodds["VegYes", "Std. Error"])

Veg.logodds.upper <- (mod.factors.coef.logodds["VegYes", "Estimate"] + 1.96 * mod.factors.coef.logodds["VegYes", "Std. Error"])



# Store the results in a data frame
log_odds_ci <- data.frame(
  groups = c( "Age","Education Higher","Education HNC/D", "Education no", "Education other", "Education Standard", "Vegetable intake"),
  lodds = summary(AIC)$coefficients[2:8,1],
  ci_low = c(Age.logodds.lower,Edu.higher.logodds.lower,Edu.HNC.logodds.lower,Edu.no.logodds.lower,Edu.other.logodds.lower, Edu.standard.logodds.lower,Veg.logodds.lower),
  ci_up = c(Age.logodds.upper, Edu.higher.logodds.upper, Edu.HNC.logodds.upper, Edu.no.logodds.upper,Edu.other.logodds.upper, Edu.standard.logodds.upper, Veg.logodds.upper)
)

```

Then, the odds ratios and their corresponding 95% confidence intervals provide valuable insights into the factors associated with obesity. The confidence intervals for the odds ratios of all predictors do not encompass the value of 1 (see @tbl-the_odds and @fig-odds). This observation is critical as it implies that the odds of obesity are significantly different from the null hypothesis value (odds ratio = 1) for each predictor. Therefore, we can conclude with 95% certainty that age, various levels of education, and vegetable intake are statistically significant factors in the prediction of obesity within our model. Specifically, age and lower educational attainment are associated with increased odds of obesity, whereas vegetable intake is associated with decreased odds, underscoring the importance of these factors in public health interventions aimed at reducing obesity prevalence.

```{r}
#| echo: false
#| label: tbl-the_odds
#| tbl-cap: Confidence interval of the Odds 

# Store the results in a data frame
odds_ci <- data.frame(
  groups = c( "Age","Education Higher","Education HNC/D", "Education no", "Education other", "Education Standard", "Vegetable intake"),
  ci_low = c(exp(Age.logodds.lower),exp(Edu.higher.logodds.lower),exp(Edu.HNC.logodds.lower),exp(Edu.no.logodds.lower),exp(Edu.other.logodds.lower), exp(Edu.standard.logodds.lower),exp(Veg.logodds.lower)),
  ci_up = c(exp(Age.logodds.upper), exp(Edu.higher.logodds.upper), exp(Edu.HNC.logodds.upper), exp(Edu.no.logodds.upper),exp(Edu.other.logodds.upper), exp(Edu.standard.logodds.upper), exp(Veg.logodds.upper))
)

kable(odds_ci, col.names = c("Groups", "confidence interval low boundary", "confidence interval uppter boundary"), caption = "Confidence interval of the odds", format="pipe")
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-odds
#| fig-cap: odds of each parameter
#| fig-align: center
#| fig-width: 4
#| fig-height: 3
plot_model(AIC, show.values = TRUE,title = "Odds", show.p = FALSE,axis.lim = c(0.5, 2))
#plot_model(model_factors, show.values = TRUE,title = "Odds", show.p = FALSE,axis.lim = c(0.5, 2))
```

For the results, the model aimed to predict probabilities of obesity was developed considering various factors, including 'Sex' and 'Fruit' consumption. However, upon evaluation, both 'Sex' and 'Fruit' were identified as statistically insignificant predictors within the model. This inclusion of insignificant factors could potentially lead to inaccuracies in the predicted probabilities of obesity. Therefore, we have omitted these variables, to enhance the accuracy and reliability of the obesity probability predictions.

```{r}
#| echo: false
#| label: tbl-pred_age
#| tbl-cap: Predicted probabilities of obesity by Age

```

@fig-pred_Age presents the predicted probabilities of obesity across different ages, indicating a nearly linear relationship. The graph shows a consistent increase in the probability of obesity as age advances, starting from around 20% in the youngest age group and ascending to close to 45% in the oldest age group represented. The trend line is almost straight, suggesting a steady rate of increase in the likelihood of obesity with age.

The shaded region around the trend line represents the confidence interval, which exhibits a slight increase in width as age progresses. This suggests a small increase in uncertainty of the predictions for the older age groups. Nonetheless, the relatively uniform width of the confidence interval across the age spectrum implies that the variance in the predicted probabilities of obesity does not drastically change with age.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-pred_Age
#| fig-cap: Predicted probabilities of obesity by Age 
#| fig-align: center
#| fig-width: 4
#| fig-height: 3

plot_model(AIC, type = "pred", terms= "Age[all]")
```

@fig-pred_Edu presents a statistical analysis on the correlation between educational levels and the projected likelihood of obesity. The data suggests a distinct inverse relationship between educational attainment and the propensity for obesity. Specifically, the graph indicates that the segment of the population without any educational qualifications registers the highest mean predicted probability for obesity. In stark contrast, individuals who have obtained a degree or higher education are attributed with the lowest mean predicted probability of being classified as obese.

Additionally, an examination of the variance in the predicted probabilities reveals significant heterogeneity within the 'Other school level' category, which surpasses the uniformity observed in both the 'No qualifications' and 'Degree or higher' categories. This variability may suggest a complex interplay between education and other socio-economic factors that influence obesity rates. These findings highlight the importance of educational attainment in public health strategies aimed at combating obesity.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-pred_Edu
#| fig-cap: Predicted probabilities of obesity by Education
#| fig-align: center
#| fig-width: 4
#| fig-height: 3

plot_model(AIC, type = "pred", terms= "Education")
```

@fig-pred_Veg illustrates the predicted probabilities of obesity with respect to vegetable consumption, as indicated by the binary categories 'Yes' and 'No'. The graph suggests that individuals who do not consume vegetables have a higher predicted probability of obesity, marked by a probability just over 28%. In contrast, the predicted probability for obesity among those who do consume vegetables is significantly lower, indicated by a probability just under 25%.

The error bars, which represent the confidence intervals, are notably longer for the 'No' category, implying greater uncertainty in the prediction for individuals who do not consume vegetables. The shorter error bars for the 'Yes' category suggest more confidence in the prediction for individuals who do consume vegetables.

This visual data suggests a potential inverse relationship between vegetable consumption and the likelihood of obesity, indicating that vegetable intake may be associated with a lower probability of being obese.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-pred_Veg
#| fig-cap: Predicted probabilities of obesity by Veg
#| fig-align: center
#| fig-width: 4
#| fig-height: 3

plot_model(AIC, type = "pred", terms = "Veg")
```

# Conclusions {#sec-ccls}

Future study
